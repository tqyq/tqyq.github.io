// https://d3js.org/d3-zoom/ Version 0.3.0. Copyright 2016 Mike Bostock.
!function(t,n){"object"==typeof exports&&"undefined"!=typeof module?n(exports,require("d3-dispatch"),require("d3-drag"),require("d3-interpolate"),require("d3-selection"),require("d3-transition")):"function"==typeof define&&define.amd?define(["exports","d3-dispatch","d3-drag","d3-interpolate","d3-selection","d3-transition"],n):n(t.d3=t.d3||{},t.d3,t.d3,t.d3,t.d3,t.d3)}(this,function(t,n,e,i,o,r){"use strict";function u(t){return function(){return t}}function h(t,n,e){this.target=t,this.type=n,this.transform=e}function s(t,n,e){this.k=t,this.x=n,this.y=e}function c(t){return t.__zoom||v}function a(){o.event.stopImmediatePropagation()}function f(){o.event.preventDefault(),o.event.stopImmediatePropagation()}function l(){return!o.event.button}function p(){var t=this.ownerSVGElement;return[[0,0],t?[t.width.baseVal.value,t.height.baseVal.value]:[this.clientWidth,this.clientHeight]]}function m(){return this.__zoom||v}function d(){function t(t){t.on("wheel.zoom",g).on("mousedown.zoom",k).on("dblclick.zoom",w).on("touchstart.zoom",M).on("touchmove.zoom",T).on("touchend.zoom touchcancel.zoom",b).style("-webkit-tap-highlight-color","rgba(0,0,0,0)").property("__zoom",m)}function c(t,n){return n=Math.max(B,Math.min(D,n)),n===t.k?t:new s(n,t.x,t.y)}function d(t,n,e){var i=n[0]-e[0]*t.k,o=n[1]-e[1]*t.k;return i===t.x&&o===t.y?t:new s(t.k,i,o)}function v(t,n){var e=Math.min(0,t.invertX(n[0][0])-S)||Math.max(0,t.invertX(n[1][0])-G),i=Math.min(0,t.invertY(n[0][1])-H)||Math.max(0,t.invertY(n[1][1])-K);return e||i?t.translate(e,i):t}function y(t){return[(+t[0][0]+ +t[1][0])/2,(+t[0][1]+ +t[1][1])/2]}function z(t,n,e){t.on("start.zoom",function(){_(this,arguments).start()}).on("interrupt.zoom end.zoom",function(){_(this,arguments).end()}).tween("zoom",function(){var t=this,o=arguments,r=_(t,o),u=j.apply(t,o),h=e||y(u),c=Math.max(u[1][0]-u[0][0],u[1][1]-u[0][1]),a=t.__zoom,f="function"==typeof n?n.apply(t,o):n,l=i.interpolateZoom(a.invert(h).concat(c/a.k),f.invert(h).concat(c/f.k));return function(t){if(1===t)t=f;else{var n=l(t),e=c/n[2];t=new s(e,h[0]-n[0]*e,h[1]-n[1]*e)}r.zoom(null,t)}})}function _(t,n){for(var e,i=0,o=W.length;o>i;++i)if((e=W[i]).that===t)return e;return new x(t,n)}function x(t,n){this.that=t,this.args=n,this.index=-1,this.active=0}function g(){function t(){P=null,n.end()}if(V.apply(this,arguments)){var n=_(this,arguments),e=this.__zoom,i=Math.max(B,Math.min(D,e.k*Math.pow(2,-o.event.deltaY*(o.event.deltaMode?120:1)/500)));if(P){var u=o.mouse(this);q[0]===u[0]&&q[1]===u[1]||(X=e.invert(q=u)),clearTimeout(P)}else{if(e.k===i)return;n.extent=j.apply(this,arguments),X=e.invert(q=o.mouse(this)),r.interrupt(this),n.start()}f(),P=setTimeout(t,C),n.zoom("mouse",v(d(c(e,i),q,X),n.extent))}}function k(){function t(){f(),Y=!0,i.zoom("mouse",v(d(i.that.__zoom,q=o.mouse(i.that),X),i.extent))}function n(){u.on("mousemove.zoom mouseup.zoom",null),e.dragEnable(o.event.view,Y),f(),i.end()}if(!I&&V.apply(this,arguments)){var i=_(this,arguments),u=o.select(o.event.view).on("mousemove.zoom",t,!0).on("mouseup.zoom",n,!0);e.dragDisable(o.event.view),a(),Y=!1,i.extent=j.apply(this,arguments),X=this.__zoom.invert(q=o.mouse(this)),r.interrupt(this),i.start()}}function w(){if(V.apply(this,arguments)){var n=this.__zoom,e=o.mouse(this),i=n.invert(e),r=n.k*(o.event.shiftKey?.5:2),u=v(d(c(n,r),e,i),j.apply(this,arguments));f(),O>0?o.select(this).transition().duration(O).call(z,u,e):o.select(this).call(t.transform,u)}}function M(){if(V.apply(this,arguments)){var t,n,e,i=_(this,arguments),u=o.event.changedTouches,h=u.length;for(a(),t=0;h>t;++t)n=u[t],e=o.touch(this,u,n.identifier),e=[e,this.__zoom.invert(e),n.identifier],i.touch0?i.touch1||(i.touch1=e):i.touch0=e;return E&&(E=clearTimeout(E),!i.touch1)?(i.end(),w.apply(this,arguments)):void(o.event.touches.length===h&&(E=setTimeout(function(){E=null},A),r.interrupt(this),i.extent=j.apply(this,arguments),i.start()))}}function T(){var t,n,e,i,r=_(this,arguments),u=o.event.changedTouches,h=u.length;for(f(),E&&(E=clearTimeout(E)),t=0;h>t;++t)n=u[t],e=o.touch(this,u,n.identifier),r.touch0&&r.touch0[2]===n.identifier?r.touch0[0]=e:r.touch1&&r.touch1[2]===n.identifier&&(r.touch1[0]=e);if(n=r.that.__zoom,r.touch1){var s=r.touch0[0],a=r.touch0[1],l=r.touch1[0],p=r.touch1[1],m=(m=l[0]-s[0])*m+(m=l[1]-s[1])*m,y=(y=p[0]-a[0])*y+(y=p[1]-a[1])*y;n=c(n,Math.sqrt(m/y)),e=[(s[0]+l[0])/2,(s[1]+l[1])/2],i=[(a[0]+p[0])/2,(a[1]+p[1])/2]}else{if(!r.touch0)return;e=r.touch0[0],i=r.touch0[1]}r.zoom("touch",v(d(n,e,i),r.extent))}function b(){var t,n,e=_(this,arguments),i=o.event.changedTouches,r=i.length;for(a(),I&&clearTimeout(I),I=setTimeout(function(){I=null},A),t=0;r>t;++t)n=i[t],e.touch0&&e.touch0[2]===n.identifier?delete e.touch0:e.touch1&&e.touch1[2]===n.identifier&&delete e.touch1;e.touch1&&!e.touch0&&(e.touch0=e.touch1,delete e.touch1),e.touch0||e.end()}var Y,q,X,E,I,P,V=l,j=p,B=0,D=1/0,S=-D,G=D,H=S,K=G,O=250,W=[],Z=n.dispatch("start","zoom","end"),A=500,C=150;return t.transform=function(t,n){var e=t.selection?t.selection():t;e.property("__zoom",m),t!==e?z(t,n):e.interrupt().each(function(){_(this,arguments).start().zoom(null,"function"==typeof n?n.apply(this,arguments):n).end()})},t.scaleBy=function(n,e){t.scaleTo(n,function(){var t=this.__zoom.k,n="function"==typeof e?e.apply(this,arguments):e;return t*n})},t.scaleTo=function(n,e){t.transform(n,function(){var t=j.apply(this,arguments),n=this.__zoom,i=y(t),o=n.invert(i),r="function"==typeof e?e.apply(this,arguments):e;return v(d(c(n,r),i,o),t)})},t.translateBy=function(n,e,i){t.transform(n,function(){return v(this.__zoom.translate("function"==typeof e?e.apply(this,arguments):e,"function"==typeof i?i.apply(this,arguments):i),j.apply(this,arguments))})},x.prototype={start:function(){return 1===++this.active&&(this.index=W.push(this)-1,this.emit("start")),this},zoom:function(t,n){return q&&"mouse"!==t&&(X=n.invert(q)),this.touch0&&"touch"!==t&&(this.touch0[1]=n.invert(this.touch0[0])),this.touch1&&"touch"!==t&&(this.touch1[1]=n.invert(this.touch1[0])),this.that.__zoom=n,this.emit("zoom"),this},end:function(){return 0===--this.active&&(W.splice(this.index,1),q=X=null,this.index=-1,this.emit("end")),this},emit:function(n){o.customEvent(new h(t,n,this.that.__zoom),Z.apply,Z,[n,this.that,this.args])}},t.filter=function(n){return arguments.length?(V="function"==typeof n?n:u(!!n),t):V},t.extent=function(n){return arguments.length?(j="function"==typeof n?n:u([[+n[0][0],+n[0][1]],[+n[1][0],+n[1][1]]]),t):j},t.scaleExtent=function(n){return arguments.length?(B=+n[0],D=+n[1],t):[B,D]},t.translateExtent=function(n){return arguments.length?(S=+n[0][0],G=+n[1][0],H=+n[0][1],K=+n[1][1],t):[[S,H],[G,K]]},t.duration=function(n){return arguments.length?(O=+n,t):O},t.on=function(){var n=Z.on.apply(Z,arguments);return n===Z?t:n},t}s.prototype={constructor:s,scale:function(t){return 1===t?this:new s(this.k*t,this.x,this.y)},translate:function(t,n){return 0===t&0===n?this:new s(this.k,this.x+this.k*t,this.y+this.k*n)},apply:function(t){return[t[0]*this.k+this.x,t[1]*this.k+this.y]},applyX:function(t){return t*this.k+this.x},applyY:function(t){return t*this.k+this.y},invert:function(t){return[(t[0]-this.x)/this.k,(t[1]-this.y)/this.k]},invertX:function(t){return(t-this.x)/this.k},invertY:function(t){return(t-this.y)/this.k},rescaleX:function(t){return t.copy().domain(t.range().map(this.invertX,this).map(t.invert,t))},rescaleY:function(t){return t.copy().domain(t.range().map(this.invertY,this).map(t.invert,t))},toString:function(){return"translate("+this.x+","+this.y+") scale("+this.k+")"}};var v=new s(1,0,0);c.prototype=s.prototype,t.zoom=d,t.zoomTransform=c,t.zoomIdentity=v,Object.defineProperty(t,"__esModule",{value:!0})});